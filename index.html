import { useState, useEffect } from "react";
import { Rnd } from "react-rnd";
import { Button } from "@/components/ui/button";

export default function VirtualDesktop() {
  const [openApps, setOpenApps] = useState([]);
  const [apps, setApps] = useState([]);

  useEffect(() => {
    // Fetch apps dynamically (mocking an API response here)
    const fetchedApps = [
      { name: "YouTube", url: "https://www.youtube.com" },
      { name: "TikTok", url: "https://www.tiktok.com" },
      { name: "Facebook", url: "https://www.facebook.com" },
      { name: "Twitter", url: "https://twitter.com" },
      { name: "Instagram", url: "https://www.instagram.com" }
    ];
    setApps(fetchedApps);
  }, []);

  const openApp = (app) => {
    setOpenApps([...openApps, { id: Date.now(), ...app, x: 50, y: 50, width: 400, height: 300 }]);
  };

  const closeApp = (id) => {
    setOpenApps(openApps.filter((app) => app.id !== id));
  };

  return (
    <div className="w-screen h-screen bg-gray-900 text-white p-4 relative overflow-hidden">
      <div className="flex gap-2 mb-4">
        {apps.map((app) => (
          <Button key={app.name} onClick={() => openApp(app)}>
            Open {app.name}
          </Button>
        ))}
      </div>

      {openApps.map((app) => (
        <Rnd
          key={app.id}
          default={{ x: app.x, y: app.y, width: app.width, height: app.height }}
          bounds="parent"
          className="absolute bg-white shadow-lg rounded-md overflow-hidden"
        >
          <div className="bg-gray-800 text-white flex justify-between p-2 cursor-move">
            <span>{app.name}</span>
            <button onClick={() => closeApp(app.id)} className="text-red-500">âœ–</button>
          </div>
          <iframe src={app.url} className="w-full h-full border-none"></iframe>
        </Rnd>
      ))}
    </div>
  );
}
